!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(e,n){return"pairs"==n&&"string"==typeof e?e:"object"==typeof e&&null!=e[n]?e[n]:f[n]}function t(e){for(var n=0;n<e.length;n++){var t=e.charAt(n),i="'"+t+"'";u[i]||(u[i]=r(t))}}function r(e){return function(n){return o(n,e)}}function i(e){var n=e.state.closeBrackets;return!n||n.override?n:e.getModeAt(e.getCursor()).closeBrackets||n}function a(n){var t=e.cmpPos(n.anchor,n.head)>0;return{anchor:new h(n.anchor.line,n.anchor.ch+(t?-1:1)),head:new h(n.head.line,n.head.ch+(t?1:-1))}}function o(t,r){var o=i(t);if(!o||t.getOption("disableInput"))return e.Pass;var l=n(o,"pairs"),f=l.indexOf(r);if(-1==f)return e.Pass;for(var u,d=n(o,"triples"),g=l.charAt(f+1)==r,p=t.listSelections(),v=f%2==0,m=0;m<p.length;m++){var b,C=p[m],x=C.head,P=t.getRange(x,h(x.line,x.ch+1));if(v&&!C.empty())b="surround";else if(!g&&v||P!=r)if(g&&x.ch>1&&d.indexOf(r)>=0&&t.getRange(h(x.line,x.ch-2),x)==r+r&&(x.ch<=2||t.getRange(h(x.line,x.ch-3),h(x.line,x.ch-2))!=r))b="addFour";else if(g){var k=0==x.ch?" ":t.getRange(h(x.line,x.ch-1),x);if(e.isWordChar(P)||k==r||e.isWordChar(k))return e.Pass;b="both"}else{if(!v||t.getLine(x.line).length!=x.ch&&!s(P,l)&&!/\s/.test(P))return e.Pass;b="both"}else b=g&&c(t,x)?"both":d.indexOf(r)>=0&&t.getRange(x,h(x.line,x.ch+3))==r+r+r?"skipThree":"skip";if(u){if(u!=b)return e.Pass}else u=b}var y=f%2?l.charAt(f-1):r,S=f%2?r:l.charAt(f+1);t.operation(function(){if("skip"==u)t.execCommand("goCharRight");else if("skipThree"==u)for(n=0;n<3;n++)t.execCommand("goCharRight");else if("surround"==u){for(var e=t.getSelections(),n=0;n<e.length;n++)e[n]=y+e[n]+S;t.replaceSelections(e,"around"),e=t.listSelections().slice();for(n=0;n<e.length;n++)e[n]=a(e[n]);t.setSelections(e)}else"both"==u?(t.replaceSelection(y+S,null),t.triggerElectric(y+S),t.execCommand("goCharLeft")):"addFour"==u&&(t.replaceSelection(y+y+y+y,"before"),t.execCommand("goCharRight"))})}function s(e,n){var t=n.lastIndexOf(e);return t>-1&&t%2==1}function l(e,n){var t=e.getRange(h(n.line,n.ch-1),h(n.line,n.ch+1));return 2==t.length?t:null}function c(e,n){var t=e.getTokenAt(h(n.line,n.ch+1));return/\bstring/.test(t.type)&&t.start==n.ch&&(0==n.ch||!/\bstring/.test(e.getTokenTypeAt(n)))}var f={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},h=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(u),r.state.closeBrackets=null),i&&(t(n(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(u))});var u={Backspace:function(t){var r=i(t);if(!r||t.getOption("disableInput"))return e.Pass;for(var a=n(r,"pairs"),o=t.listSelections(),s=0;s<o.length;s++){if(!o[s].empty())return e.Pass;var c=l(t,o[s].head);if(!c||a.indexOf(c)%2!=0)return e.Pass}for(s=o.length-1;s>=0;s--){var f=o[s].head;t.replaceRange("",h(f.line,f.ch-1),h(f.line,f.ch+1),"+delete")}},Enter:function(t){var r=i(t),a=r&&n(r,"explode");if(!a||t.getOption("disableInput"))return e.Pass;for(var o=t.listSelections(),s=0;s<o.length;s++){if(!o[s].empty())return e.Pass;var c=l(t,o[s].head);if(!c||a.indexOf(c)%2!=0)return e.Pass}t.operation(function(){var e=t.lineSeparator()||"\n";t.replaceSelection(e+e,null),t.execCommand("goCharLeft"),o=t.listSelections();for(var n=0;n<o.length;n++){var r=o[n].head.line;t.indentLine(r,null,!0),t.indentLine(r+1,null,!0)}})}};t(f.pairs+"`")});